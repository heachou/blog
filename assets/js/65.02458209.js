(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{575:function(t,s,n){"use strict";n.r(s);var a=n(6),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[t._v("vue-router 基本原理")])]),t._v(" "),n("p",[t._v("vue-router 支持两种模式，hash 模式和 history 模式，其中 history 模式需要简单的配置才可以在生产环境使用，history 模式对用户来说，更加的友好，符合我们的习惯,url 更加的规范")]),t._v(" "),n("h2",{attrs:{id:"hash-路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hash-路由"}},[t._v("#")]),t._v(" hash 路由")]),t._v(" "),n("p",[t._v("话不多说，直接上代码")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听hash变化")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 浏览器的前进后退也会被监听到")]),t._v("\nwindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onhashchange")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'old url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oldURL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'new url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("newURL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hash:'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 改变url")]),t._v("\nlocation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#/user'")]),t._v("\n")])])]),n("p",[t._v("当我们修改 url 的时候，会收到 hashchange 的回调，因此我们就能根据此做我们想要的逻辑")]),t._v(" "),n("h2",{attrs:{id:"history-模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#history-模式"}},[t._v("#")]),t._v(" history 模式")]),t._v(" "),n("p",[t._v("话不多说，直接上代码")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 前进后退，可以触发onpopstate")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// state 里面可以携带参数")]),t._v("\nwindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onpopstate")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'onpopstate'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pathname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'page_test'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nwindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pushState")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("vue-router 中，还存在 "),n("code",[t._v("redirect")]),t._v(" 重定向，其实相当于是根据 "),n("code",[t._v("history.replaceState")]),t._v("来实现的，与"),n("code",[t._v("pushState")]),t._v("不同的是，"),n("code",[t._v("replaceState")]),t._v("并不会往路由栈里面添加一条记录，而是会替换掉当前的路由，\n我们上面提到，history模式需要简单的后端配置，具体"),n("a",{attrs:{href:"https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90",target:"_blank",rel:"noopener noreferrer"}},[t._v("点击这里"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("在项目中，我们通常使用nginx,这里附一份简单的nginx配置，可根据需要修改")]),t._v(" "),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#user  nobody;")]),t._v("\nworker_processes  1;\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_log  logs/error.log;")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_log  logs/error.log  notice;")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_log  logs/error.log  info;")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#pid        logs/nginx.pid;")]),t._v("\n\n\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  2048;\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       mime.types;\n    default_type  application/octet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stream;\n    client_max_body_size 200m;\n\n    sendfile        on;\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#keepalive_timeout  0;")]),t._v("\n    keepalive_timeout  65s;\n    keepalive_requests 1000;\n\n    gzip  on;\n\n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       8080;\n        server_name  localhost;\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#charset koi8-r;")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log  logs/host.access.log  main;")]),t._v("\n\n        location ~ ."),n("span",{pre:!0,attrs:{class:"token important"}},[t._v("*\\.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm)$")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            expires 7d;\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root html;\n            try_files $uri /index.html;\n            add_header Access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Origin "),n("span",{pre:!0,attrs:{class:"token important"}},[t._v("*;")]),t._v(" \n            add_header Access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Credentials true; \n            add_header Access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Methods 'GET"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" POST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PUT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("DELETE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("OPTIONS'; \n            add_header Access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Headers 'DNT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Mx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ReqToken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("Keep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Alive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Agent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Requested"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("With"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("If"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Modified"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Since"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("Cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("Content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Type';\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# html文件禁止缓存，解决发版后缓存问题")]),t._v("\n            if ($request_filename ~* \\.(htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("html)$) "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              add_header  Cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control  no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("store;\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 跨域OPTIONS直接返回204")]),t._v("\n            if ($request_method = 'OPTIONS') "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n                return 204; \n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx 代理，解决跨域问题")]),t._v("\n        location /web/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        \tproxy_pass http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//xxx.xxx.xx/web/;\n    \t  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_page  404              /404.html;")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redirect server error pages to the static page /50x.html")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html;\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);